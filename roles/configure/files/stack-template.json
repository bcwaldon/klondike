{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Metadata": {
    "AWS::CloudFormation::Designer": {
      "46c5f359-b0f8-400a-924a-7416577bb1e4": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -810,
          "y": 900
        },
        "z": 0,
        "embeds": [],
        "isconnectedto": [
          "81ac2c65-7edd-45b6-a300-2e0f5576cd84",
          "f591c362-5976-4efe-aca1-f1c0cb9f31af"
        ],
        "isassociatedwith": [
          "d0fb5fdb-de68-459c-ab39-a326ea5abdf3"
        ]
      },
      "920bfac1-4e49-4e20-a9f3-13881159c775": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -810,
          "y": 1110
        },
        "z": 0,
        "embeds": [],
        "isconnectedto": [
          "6c2ea801-0bfa-4e7b-92c8-3eef2f97dcce"
        ],
        "isassociatedwith": [
          "f1eabfda-793d-4e4c-b98e-fcb8acf8c0cb"
        ]
      },
      "d0fb5fdb-de68-459c-ab39-a326ea5abdf3": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -910,
          "y": 900
        },
        "z": 0,
        "embeds": [],
        "ismemberof": [
          "4cd01314-51ae-4fac-9c95-36004183543b"
        ],
        "isrelatedto": [
          "f77c932d-e2ff-48ee-b941-decf296031a5"
        ]
      },
      "f1eabfda-793d-4e4c-b98e-fcb8acf8c0cb": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -910,
          "y": 1110
        },
        "z": 0,
        "embeds": [],
        "ismemberof": [
          "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        ],
        "isrelatedto": [
          "f77c932d-e2ff-48ee-b941-decf296031a5",
          "54a2c1e8-5f96-46e2-977d-277bf296f00f"
        ]
      },
      "6c1cb6f9-94a4-41ec-965a-a365accac0e6": {
        "source": {
          "id": "ce830535-a3bf-409e-a0e9-1ce36986fe8e"
        },
        "target": {
          "id": "46c5f359-b0f8-400a-924a-7416577bb1e4"
        },
        "z": 11
      },
      "6239686a-4431-4fc5-8d46-dfc631ec4f79": {
        "source": {
          "id": "ce830535-a3bf-409e-a0e9-1ce36986fe8e"
        },
        "target": {
          "id": "920bfac1-4e49-4e20-a9f3-13881159c775"
        },
        "z": 12
      },
      "5484bcc1-2c0e-4812-97d0-73f7c6ac88ba": {
        "source": {
          "id": "920bfac1-4e49-4e20-a9f3-13881159c775"
        },
        "target": {
          "id": "ce830535-a3bf-409e-a0e9-1ce36986fe8e"
        },
        "z": 11
      },
      "62a2399e-c6ec-4957-871d-ff247df994c8": {
        "source": {
          "id": "46c5f359-b0f8-400a-924a-7416577bb1e4"
        },
        "target": {
          "id": "ce830535-a3bf-409e-a0e9-1ce36986fe8e"
        },
        "z": 12
      },
      "f77c932d-e2ff-48ee-b941-decf296031a5": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -910,
          "y": 800
        },
        "z": 0,
        "embeds": [],
        "isassociatedwith": [
          "e35ecfc4-b188-4813-ae0f-de0d64b4be50"
        ]
      },
      "e35ecfc4-b188-4813-ae0f-de0d64b4be50": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -1010,
          "y": 800
        },
        "z": 0,
        "embeds": []
      },
      "07de01ff-8c82-4ed8-9b50-c9277fea87cc": {
        "source": {
          "id": "f77c932d-e2ff-48ee-b941-decf296031a5"
        },
        "target": {
          "id": "e35ecfc4-b188-4813-ae0f-de0d64b4be50"
        },
        "z": 11
      },
      "54a2c1e8-5f96-46e2-977d-277bf296f00f": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -910,
          "y": 1210
        },
        "z": 0,
        "embeds": [],
        "isassociatedwith": [
          "d66420b2-c64b-426d-97f6-5665037fa31f"
        ]
      },
      "d66420b2-c64b-426d-97f6-5665037fa31f": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -1010,
          "y": 1210
        },
        "z": 0,
        "embeds": []
      },
      "e533c706-fe3b-4ba7-b3d9-ccbd5337c4ba": {
        "source": {
          "id": "54a2c1e8-5f96-46e2-977d-277bf296f00f"
        },
        "target": {
          "id": "d66420b2-c64b-426d-97f6-5665037fa31f"
        },
        "z": 11
      },
      "4cd01314-51ae-4fac-9c95-36004183543b": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -1010,
          "y": 900
        },
        "z": 0,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": []
      },
      "6fefc014-dddb-41a8-96b8-02255342c5a4": {
        "source": {
          "id": "d0fb5fdb-de68-459c-ab39-a326ea5abdf3"
        },
        "target": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        },
        "z": 11
      },
      "251f6d10-84e4-44a1-b93e-67bbe9078fba": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -1010,
          "y": 1110
        },
        "z": 0,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": []
      },
      "f00c9142-37b5-4239-ad24-e5a09a412882": {
        "source": {
          "id": "f1eabfda-793d-4e4c-b98e-fcb8acf8c0cb"
        },
        "target": {
          "id": "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        },
        "z": 11
      },
      "cd2f2754-a1e2-4275-a6e6-ec164c7a1dbf": {
        "source": {
          "id": "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        },
        "target": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        },
        "z": 0
      },
      "e541f9e6-602c-4226-9421-bf5178777cac": {
        "source": {
          "id": "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        },
        "target": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        },
        "z": 0
      },
      "aa967c67-739d-45e8-baba-7c782f487c96": {
        "source": {
          "id": "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        },
        "target": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        },
        "z": 2
      },
      "6c2ea801-0bfa-4e7b-92c8-3eef2f97dcce": {
        "size": {
          "width": 250,
          "height": 120
        },
        "position": {
          "x": -670,
          "y": 1050
        },
        "z": 2,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": []
      },
      "f591c362-5976-4efe-aca1-f1c0cb9f31af": {
        "size": {
          "width": 250,
          "height": 160
        },
        "position": {
          "x": -670,
          "y": 870
        },
        "z": 2,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": []
      },
      "a487cf69-e5ce-4956-85df-761e6427deef": {
        "size": {
          "width": 520,
          "height": 600
        },
        "position": {
          "x": -690,
          "y": 590
        },
        "z": 1,
        "embeds": [
          "314120e5-87bf-4791-80ae-cd443fad4186",
          "4719e386-5f75-42ec-9fb2-91f8386f9f87",
          "317ab59f-2379-451a-9fbc-c397fd31dd5c",
          "873403fc-c264-4f6b-86ae-092abee2a1d0",
          "37fc6d23-1902-4172-ab24-1c0cd8eab5b7",
          "f591c362-5976-4efe-aca1-f1c0cb9f31af",
          "6c2ea801-0bfa-4e7b-92c8-3eef2f97dcce",
          "251f6d10-84e4-44a1-b93e-67bbe9078fba",
          "4cd01314-51ae-4fac-9c95-36004183543b"
        ]
      },
      "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 30,
          "y": 590
        },
        "z": 1,
        "embeds": [],
        "dependson": [
          "a487cf69-e5ce-4956-85df-761e6427deef"
        ]
      },
      "529bca45-b10b-47ef-81ab-6a55c9a5488c": {
        "source": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        },
        "target": {
          "id": "a487cf69-e5ce-4956-85df-761e6427deef"
        },
        "z": 1
      },
      "7be61a49-99da-485c-92bf-cf22f2d8e361": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -490,
          "y": 840
        },
        "z": 3,
        "parent": "f591c362-5976-4efe-aca1-f1c0cb9f31af",
        "embeds": []
      },
      "37fc6d23-1902-4172-ab24-1c0cd8eab5b7": {
        "size": {
          "width": 120,
          "height": 120
        },
        "position": {
          "x": -370,
          "y": 670
        },
        "z": 2,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": [
          "3ecb5892-f24a-4c85-aa24-e275f34308a1"
        ]
      },
      "3ea679dd-6851-4f71-b9da-063ff1955416": {
        "source": {
          "id": "873403fc-c264-4f6b-86ae-092abee2a1d0"
        },
        "target": {
          "id": "f591c362-5976-4efe-aca1-f1c0cb9f31af"
        },
        "z": 2
      },
      "3ecb5892-f24a-4c85-aa24-e275f34308a1": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -340,
          "y": 700
        },
        "z": 3,
        "parent": "37fc6d23-1902-4172-ab24-1c0cd8eab5b7",
        "embeds": [],
        "references": [
          "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        ],
        "dependson": [
          "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        ]
      },
      "c7870f0c-c5cc-4ebc-b3af-f40b1c50b95c": {
        "source": {
          "id": "3ecb5892-f24a-4c85-aa24-e275f34308a1"
        },
        "target": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        },
        "z": 6
      },
      "dd161430-6440-4ef3-856b-99c6e8a6bbc5": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -500,
          "y": 740
        },
        "z": 3,
        "parent": "314120e5-87bf-4791-80ae-cd443fad4186",
        "embeds": [],
        "dependson": [
          "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55",
          "a487cf69-e5ce-4956-85df-761e6427deef"
        ],
        "isrelatedto": [
          "7b1d4d3c-5b8f-4e75-b58f-824172bbf1cc"
        ]
      },
      "873403fc-c264-4f6b-86ae-092abee2a1d0": {
        "size": {
          "width": 110,
          "height": 120
        },
        "position": {
          "x": -360,
          "y": 980
        },
        "z": 2,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": [
          "fe300dd1-8127-4ecf-a1f2-39141a6e498f"
        ]
      },
      "fe300dd1-8127-4ecf-a1f2-39141a6e498f": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -330,
          "y": 1010
        },
        "z": 3,
        "parent": "873403fc-c264-4f6b-86ae-092abee2a1d0",
        "embeds": [],
        "references": [
          "dd161430-6440-4ef3-856b-99c6e8a6bbc5"
        ],
        "isrelatedto": [
          "dd161430-6440-4ef3-856b-99c6e8a6bbc5"
        ]
      },
      "628052e5-746b-4228-8295-5d536a59f131": {
        "source": {
          "id": "873403fc-c264-4f6b-86ae-092abee2a1d0"
        },
        "target": {
          "id": "6c2ea801-0bfa-4e7b-92c8-3eef2f97dcce"
        },
        "z": 2
      },
      "7b1d4d3c-5b8f-4e75-b58f-824172bbf1cc": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 30,
          "y": 730
        },
        "z": 0,
        "embeds": []
      },
      "2e1b901d-8f50-43a4-b60e-8be9d368e11d": {
        "source": {
          "id": "dd161430-6440-4ef3-856b-99c6e8a6bbc5"
        },
        "target": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        },
        "z": 12
      },
      "81ac2c65-7edd-45b6-a300-2e0f5576cd84": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -430,
          "y": 510
        },
        "z": 0,
        "embeds": [],
        "isconnectedto": [
          "f591c362-5976-4efe-aca1-f1c0cb9f31af",
          "314120e5-87bf-4791-80ae-cd443fad4186"
        ],
        "ismemberof": [
          "317ab59f-2379-451a-9fbc-c397fd31dd5c"
        ]
      },
      "c0d7be0d-0c48-4d78-99d8-902b14fdae1a": {
        "source": {
          "id": "81ac2c65-7edd-45b6-a300-2e0f5576cd84"
        },
        "target": {
          "id": "f591c362-5976-4efe-aca1-f1c0cb9f31af"
        },
        "z": 11
      },
      "317ab59f-2379-451a-9fbc-c397fd31dd5c": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -430,
          "y": 410
        },
        "z": 0,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": []
      },
      "ba5ed5e4-dbc6-46d0-99b6-11844d72790b": {
        "source": {
          "id": "81ac2c65-7edd-45b6-a300-2e0f5576cd84"
        },
        "target": {
          "id": "317ab59f-2379-451a-9fbc-c397fd31dd5c"
        },
        "z": 12
      },
      "63fb8b3c-ade4-4fab-a675-c2a2b30eb4a0": {
        "source": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        },
        "target": {
          "id": "317ab59f-2379-451a-9fbc-c397fd31dd5c"
        },
        "z": 0
      },
      "e3b29f12-ac4c-44b2-aaae-abbfa7b9be82": {
        "source": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        },
        "target": {
          "id": "a487cf69-e5ce-4956-85df-761e6427deef"
        },
        "z": 11
      },
      "3a4ade40-765a-4019-a7e0-1d24b0643488": {
        "source": {
          "id": "dd161430-6440-4ef3-856b-99c6e8a6bbc5"
        },
        "target": {
          "id": "a487cf69-e5ce-4956-85df-761e6427deef"
        },
        "z": 11
      },
      "0374cc4d-4484-4e1e-bc01-7817a99d2f72": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 30,
          "y": 820
        },
        "z": 0,
        "embeds": [],
        "isrelatedto": [
          "81ac2c65-7edd-45b6-a300-2e0f5576cd84"
        ]
      },
      "deae6483-5670-458c-8b8a-436bce09d4b2": {
        "source": {
          "id": "3ecb5892-f24a-4c85-aa24-e275f34308a1"
        },
        "target": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        },
        "z": 11
      },
      "4f7be02b-961c-4b46-9bb9-9fdf6b78ce1a": {
        "source": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55",
          "selector": "g:nth-child(1) g:nth-child(4) g:nth-child(2) circle:nth-child(1)     ",
          "port": "AWS::DependencyLink-*"
        },
        "target": {
          "id": "a487cf69-e5ce-4956-85df-761e6427deef"
        },
        "z": 13
      },
      "c1dcc697-c876-4d7d-b222-18013870cef9": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -900,
          "y": 690
        },
        "z": 0,
        "embeds": [],
        "ismemberof": [
          "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        ],
        "isrelatedto": [
          "f77c932d-e2ff-48ee-b941-decf296031a5",
          "13349f45-7e38-4fcc-a295-fe5b69a132ca"
        ]
      },
      "8735ffc7-d4fb-4cdd-befa-8af9fd19f031": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -800,
          "y": 690
        },
        "z": 0,
        "embeds": [],
        "isconnectedto": [
          "81ac2c65-7edd-45b6-a300-2e0f5576cd84",
          "314120e5-87bf-4791-80ae-cd443fad4186"
        ],
        "isassociatedwith": [
          "c1dcc697-c876-4d7d-b222-18013870cef9"
        ]
      },
      "3cbbc1a8-3558-410c-9ba2-4be91920e29a": {
        "source": {
          "id": "8735ffc7-d4fb-4cdd-befa-8af9fd19f031"
        },
        "target": {
          "id": "c1dcc697-c876-4d7d-b222-18013870cef9"
        },
        "z": 11
      },
      "4719e386-5f75-42ec-9fb2-91f8386f9f87": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -1000,
          "y": 690
        },
        "z": 0,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": []
      },
      "3541fdd2-09f7-40f4-bbd1-df7ed407ddca": {
        "source": {
          "id": "c1dcc697-c876-4d7d-b222-18013870cef9"
        },
        "target": {
          "id": "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        },
        "z": 12
      },
      "a94ef956-e01a-4abe-9d0d-d6d0eb1bce02": {
        "source": {
          "id": "1746deb0-5dd0-429b-8bc4-7b0ccfbdc0ef"
        },
        "target": {
          "id": "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        },
        "z": 11
      },
      "3e8a7351-bf88-4241-8fe3-81604ee88e97": {
        "source": {
          "id": "c1dcc697-c876-4d7d-b222-18013870cef9"
        },
        "target": {
          "id": "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        },
        "z": 11
      },
      "13349f45-7e38-4fcc-a295-fe5b69a132ca": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -900,
          "y": 590
        },
        "z": 0,
        "embeds": [],
        "isassociatedwith": [
          "d3385b05-b7cc-42cb-a04d-4f49389dfc3d"
        ]
      },
      "d3385b05-b7cc-42cb-a04d-4f49389dfc3d": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -1000,
          "y": 590
        },
        "z": 0,
        "embeds": []
      },
      "8b8c8711-1ce4-4936-ae30-f5de4564fa38": {
        "source": {
          "id": "13349f45-7e38-4fcc-a295-fe5b69a132ca"
        },
        "target": {
          "id": "d3385b05-b7cc-42cb-a04d-4f49389dfc3d"
        },
        "z": 11
      },
      "314120e5-87bf-4791-80ae-cd443fad4186": {
        "size": {
          "width": 250,
          "height": 160
        },
        "position": {
          "x": -670,
          "y": 660
        },
        "z": 2,
        "parent": "a487cf69-e5ce-4956-85df-761e6427deef",
        "embeds": [
          "dd161430-6440-4ef3-856b-99c6e8a6bbc5"
        ]
      },
      "2e2c5361-9705-4e82-b4bc-8386b58f9f87": {
        "source": {
          "id": "8735ffc7-d4fb-4cdd-befa-8af9fd19f031"
        },
        "target": {
          "id": "314120e5-87bf-4791-80ae-cd443fad4186"
        },
        "z": 11
      },
      "c3e68280-8668-40f1-ac64-0e5afe3f08d1": {
        "source": {
          "id": "46c5f359-b0f8-400a-924a-7416577bb1e4"
        },
        "target": {
          "id": "f591c362-5976-4efe-aca1-f1c0cb9f31af"
        },
        "z": 12
      },
      "505c2107-b4cb-466c-a646-6caadb889c56": {
        "source": {
          "id": "37fc6d23-1902-4172-ab24-1c0cd8eab5b7"
        },
        "target": {
          "id": "314120e5-87bf-4791-80ae-cd443fad4186"
        },
        "z": 2
      },
      "c43e1ade-963e-4a64-91a6-2071205264f5": {
        "source": {
          "id": "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        },
        "target": {
          "id": "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        },
        "z": 0
      },
      "11c76f59-2ebe-409b-9a55-e5f1e92b0ab9": {
        "source": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        },
        "target": {
          "id": "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        },
        "z": 0
      }
    }
  },
  "Resources": {
    "ControllerLC": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "AssociatePublicIpAddress": false,
        "IamInstanceProfile": {
          "Ref": "ControllerIAMInstanceProfile"
        },
        "ImageId": {
          "Ref": "CoreOSImageID"
        },
        "InstanceType": {
          "Ref": "ControllerInstanceType"
        },
        "SecurityGroups": [
          {
            "Ref": "ControllerSecurityGroup"
          }
        ],
        "UserData": {
          "Ref": "ControllerUserData"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "d0fb5fdb-de68-459c-ab39-a326ea5abdf3"
        }
      }
    },
    "ControllerASG": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "MinSize": {
          "Ref": "ControllerInstanceCount"
        },
        "MaxSize": {
          "Ref": "ControllerInstanceCount"
        },
        "DesiredCapacity": {
          "Ref": "ControllerInstanceCount"
        },
        "LaunchConfigurationName": {
          "Ref": "ControllerLC"
        },
        "AvailabilityZones": [
          {
            "Ref": "AvailabilityZone"
          }
        ],
        "Tags": [
          {
            "Key": "KubernetesCluster",
            "Value": {
              "Ref": "ClusterName"
            },
            "PropagateAtLaunch": true
          },
          {
            "Key": "group",
            "Value": "controller",
            "PropagateAtLaunch": true
          }
        ],
        "LoadBalancerNames": [
          {
            "Ref": "ControllerLoadBalancer"
          }
        ],
        "VPCZoneIdentifier": [
          {
            "Ref": "ControllerSubnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "46c5f359-b0f8-400a-924a-7416577bb1e4"
        }
      }
    },
    "WorkerASG": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "MinSize": 1,
        "MaxSize": 100,
        "DesiredCapacity": {
          "Ref": "WorkerInstanceCount"
        },
        "LaunchConfigurationName": {
          "Ref": "WorkerLC"
        },
        "AvailabilityZones": [
          {
            "Ref": "AvailabilityZone"
          }
        ],
        "VPCZoneIdentifier": [
          {
            "Ref": "WorkerSubnet"
          }
        ],
        "Tags": [
          {
            "Key": "KubernetesCluster",
            "Value": {
              "Ref": "ClusterName"
            },
            "PropagateAtLaunch": true
          },
          {
            "Key": "group",
            "Value": "worker",
            "PropagateAtLaunch": true
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "920bfac1-4e49-4e20-a9f3-13881159c775"
        }
      }
    },
    "WorkerLC": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "AssociatePublicIpAddress": false,
        "IamInstanceProfile": {
          "Ref": "WorkerIAMInstanceProfile"
        },
        "ImageId": {
          "Ref": "CoreOSImageID"
        },
        "InstanceType": {
          "Ref": "WorkerInstanceType"
        },
        "SecurityGroups": [
          {
            "Ref": "WorkerSecurityGroup"
          }
        ],
        "UserData": {
          "Ref": "WorkerUserData"
        },
        "EbsOptimized": true,
        "BlockDeviceMappings": [
          {
            "DeviceName": "/dev/xvda",
            "Ebs": {
              "VolumeSize": 32,
              "Iops": 960,
              "VolumeType": "io1",
              "DeleteOnTermination": true
            }
          },
          {
            "DeviceName": "/dev/xvdb",
            "Ebs": {
              "VolumeSize": 128,
              "VolumeType": "gp2",
              "DeleteOnTermination": true
            }
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f1eabfda-793d-4e4c-b98e-fcb8acf8c0cb"
        }
      }
    },
    "ControllerIAMInstanceProfile": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Path": "/",
        "Roles": [
          {
            "Ref": "ControllerIAMRole"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f77c932d-e2ff-48ee-b941-decf296031a5"
        }
      }
    },
    "ControllerIAMRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "Path": "/",
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": "ec2:*",
                  "Resource": "*"
                },
                {
                  "Effect": "Allow",
                  "Action": "elasticloadbalancing:*",
                  "Resource": "*"
                }
              ]
            }
          }
        ],
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "ec2.amazonaws.com"
                ]
              },
              "Action": [
                "sts:AssumeRole"
              ]
            }
          ]
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "e35ecfc4-b188-4813-ae0f-de0d64b4be50"
        }
      }
    },
    "WorkerIAMInstanceProfile": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [
          {
            "Ref": "WorkerIAMRole"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "54a2c1e8-5f96-46e2-977d-277bf296f00f"
        }
      }
    },
    "WorkerIAMRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "Path": "/",
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": "ec2:Describe*",
                  "Resource": "*"
                },
                {
                  "Effect": "Allow",
                  "Action": "ec2:AttachVolume",
                  "Resource": "*"
                },
                {
                  "Effect": "Allow",
                  "Action": "ec2:DetachVolume",
                  "Resource": "*"
                }
              ]
            }
          },
          {
            "PolicyName": "ecr-readonly",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Action": [
                    "ecr:BatchCheckLayerAvailability",
                    "ecr:BatchGetImage",
                    "ecr:DescribeRepositories",
                    "ecr:GetAuthorizationToken",
                    "ecr:GetDownloadUrlForLayer",
                    "ecr:GetManifest",
                    "ecr:ListImages"
                  ],
                  "Effect": "Allow",
                  "Resource": "*"
                }
              ]
            }
          }
        ],
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "ec2.amazonaws.com"
                ]
              },
              "Action": [
                "sts:AssumeRole"
              ]
            }
          ]
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "d66420b2-c64b-426d-97f6-5665037fa31f"
        }
      }
    },
    "ControllerSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "ControllerSecurityGroup",
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "SecurityGroupEgress": [
          {
            "IpProtocol": "TCP",
            "FromPort": 0,
            "ToPort": 65535,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "UDP",
            "FromPort": 0,
            "ToPort": 65535,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "ICMP",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIp": "0.0.0.0/0"
          }
        ],
        "SecurityGroupIngress": [
          {
            "IpProtocol": "ICMP",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIp": "0.0.0.0/0"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "4cd01314-51ae-4fac-9c95-36004183543b"
        }
      }
    },
    "ControllerSecurityGroupIngressEtcd": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "FromPort": 2380,
        "ToPort": 2380,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "cd2f2754-a1e2-4275-a6e6-ec164c7a1dbf"
        }
      }
    },
    "ControllerSecurityGroupIngressLoadBalancerToAPI": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "ControllerLoadBalancerSecurityGroup"
        },
        "FromPort": 6443,
        "ToPort": 6443,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "63fb8b3c-ade4-4fab-a675-c2a2b30eb4a0"
        }
      }
    },
    "ControllerSecurityGroupIngressWorkerToAPI": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "FromPort": 6443,
        "ToPort": 6443,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "63fb8b3c-ade4-4fab-a675-c2a2b30eb4a0"
        }
      }
    },
    "ControllerSecurityGroupIngressBastionSSH": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "BastionSecurityGroup"
        },
        "FromPort": 22,
        "ToPort": 22,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "11c76f59-2ebe-409b-9a55-e5f1e92b0ab9"
        }
      }
    },
    "WorkerSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "WorkerSecurityGroup",
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "SecurityGroupEgress": [
          {
            "IpProtocol": "TCP",
            "FromPort": 0,
            "ToPort": 65535,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "UDP",
            "FromPort": 0,
            "ToPort": 65535,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "ICMP",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIp": "0.0.0.0/0"
          }
        ],
        "SecurityGroupIngress": [
          {
            "IpProtocol": "ICMP",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "TCP",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIp": "0.0.0.0/0"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "251f6d10-84e4-44a1-b93e-67bbe9078fba"
        }
      }
    },
    "WorkerSecurityGroupIngressBastionSSH": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "BastionSecurityGroup"
        },
        "FromPort": 22,
        "ToPort": 22,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "c43e1ade-963e-4a64-91a6-2071205264f5"
        }
      }
    },
    "WorkerSecurityGroupIngressControllerToKubelet": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "FromPort": 10250,
        "ToPort": 10250,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "cd2f2754-a1e2-4275-a6e6-ec164c7a1dbf"
        }
      }
    },
    "WorkerSecurityGroupIngressControllerToCAdvisor": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "ControllerSecurityGroup"
        },
        "FromPort": 4194,
        "ToPort": 4194,
        "IpProtocol": "TCP"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "e541f9e6-602c-4226-9421-bf5178777cac"
        }
      }
    },
    "WorkerSecurityGroupIngressSelfTCP": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "FromPort": 0,
        "ToPort": 65535,
        "IpProtocol": "TCP"
      }
    },
    "WorkerSecurityGroupIngressSelfUDP": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "SourceSecurityGroupId": {
          "Ref": "WorkerSecurityGroup"
        },
        "FromPort": 0,
        "ToPort": 65535,
        "IpProtocol": "UDP"
      }
    },
    "WorkerSubnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "CidrBlock": "10.0.99.0/24",
        "MapPublicIpOnLaunch": false,
        "AvailabilityZone": {
          "Ref": "AvailabilityZone"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "6c2ea801-0bfa-4e7b-92c8-3eef2f97dcce"
        }
      }
    },
    "ControllerSubnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "CidrBlock": "10.0.255.0/26",
        "MapPublicIpOnLaunch": false,
        "AvailabilityZone": {
          "Ref": "AvailabilityZone"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f591c362-5976-4efe-aca1-f1c0cb9f31af"
        }
      }
    },
    "ClusterVPC": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "CidrBlock": "10.0.0.0/16",
        "EnableDnsSupport": true,
        "EnableDnsHostnames": true,
        "InstanceTenancy": "default",
        "Tags": [
          {
            "Key": "Name",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "KubernetesCluster",
            "Value": {
              "Ref": "ClusterName"
            }
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "a487cf69-e5ce-4956-85df-761e6427deef"
        }
      }
    },
    "ClusterInternetGateway": {
      "Type": "AWS::EC2::InternetGateway",
      "Properties": {},
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "dd7a601c-41ee-40e3-90a8-a9edd1ea4e55"
        }
      },
      "DependsOn": [
        "ClusterVPC"
      ]
    },
    "ClusterVPCGatewayAttachment": {
      "Type": "AWS::EC2::VPCGatewayAttachment",
      "Properties": {
        "InternetGatewayId": {
          "Ref": "ClusterInternetGateway"
        },
        "VpcId": {
          "Ref": "ClusterVPC"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "529bca45-b10b-47ef-81ab-6a55c9a5488c"
        }
      }
    },
    "PublicNATGateway": {
      "Type": "AWS::EC2::NatGateway",
      "Properties": {
        "SubnetId": {
          "Ref": "PublicSubnet"
        },
        "AllocationId": {
          "Fn::GetAtt": [
            "PublicNATGatewayIP",
            "AllocationId"
          ]
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "dd161430-6440-4ef3-856b-99c6e8a6bbc5"
        }
      },
      "DependsOn": [
        "ClusterInternetGateway",
        "ClusterVPC"
      ]
    },
    "PublicRouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "ClusterVPC"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "37fc6d23-1902-4172-ab24-1c0cd8eab5b7"
        }
      }
    },
    "ControllerSubnetRouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "PrivateRouteTable"
        },
        "SubnetId": {
          "Ref": "ControllerSubnet"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "3ea679dd-6851-4f71-b9da-063ff1955416"
        }
      }
    },
    "PublicRouteToInternet": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        },
        "GatewayId": {
          "Ref": "ClusterInternetGateway"
        },
        "DestinationCidrBlock": "0.0.0.0/0"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "3ecb5892-f24a-4c85-aa24-e275f34308a1"
        }
      },
      "DependsOn": [
        "ClusterInternetGateway"
      ]
    },
    "PrivateRouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "Tags": [
          {
            "Key": "KubernetesCluster",
            "Value": {
              "Ref": "ClusterName"
            }
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "873403fc-c264-4f6b-86ae-092abee2a1d0"
        }
      }
    },
    "PrivateRouteToInternet": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "RouteTableId": {
          "Ref": "PrivateRouteTable"
        },
        "NatGatewayId": {
          "Ref": "PublicNATGateway"
        },
        "DestinationCidrBlock": "0.0.0.0/0"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "fe300dd1-8127-4ecf-a1f2-39141a6e498f"
        }
      }
    },
    "PublicSubnetRouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        },
        "SubnetId": {
          "Ref": "PublicSubnet"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "505c2107-b4cb-466c-a646-6caadb889c56"
        }
      }
    },
    "WorkerSubnetRouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "PrivateRouteTable"
        },
        "SubnetId": {
          "Ref": "WorkerSubnet"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "628052e5-746b-4228-8295-5d536a59f131"
        }
      }
    },
    "PublicNATGatewayIP": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Domain": "vpc"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "7b1d4d3c-5b8f-4e75-b58f-824172bbf1cc"
        }
      }
    },
    "ControllerLoadBalancer": {
      "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
      "Properties": {
        "Subnets": [
          {
            "Ref": "PublicSubnet"
          }
        ],
        "SecurityGroups": [
          {
            "Ref": "ControllerLoadBalancerSecurityGroup"
          }
        ],
        "Listeners": [
          {
            "InstancePort": 6443,
            "InstanceProtocol": "TCP",
            "LoadBalancerPort": 443,
            "Protocol": "TCP"
          }
        ],
        "HealthCheck": {
          "Target": "TCP:6443",
          "HealthyThreshold": "2",
          "Interval": "6",
          "Timeout": "5",
          "UnhealthyThreshold": "2"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "81ac2c65-7edd-45b6-a300-2e0f5576cd84"
        }
      }
    },
    "ControllerLoadBalancerSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "ControllerLoadBalancerSecurityGroup",
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "TCP",
            "FromPort": 443,
            "ToPort": 443,
            "CidrIp": "0.0.0.0/0"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "317ab59f-2379-451a-9fbc-c397fd31dd5c"
        }
      }
    },
    "ControllerLoadBalancerDNSRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "HostedZone"
              },
              "."
            ]
          ]
        },
        "Name": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "ExternalFQDN"
              },
              "."
            ]
          ]
        },
        "Type": "CNAME",
        "TTL": "300",
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "ControllerLoadBalancer",
              "DNSName"
            ]
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "0374cc4d-4484-4e1e-bc01-7817a99d2f72"
        }
      }
    },
    "BastionLC": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "SecurityGroups": [
          {
            "Ref": "BastionSecurityGroup"
          }
        ],
        "AssociatePublicIpAddress": true,
        "IamInstanceProfile": {
          "Ref": "BastionIAMInstanceProfile"
        },
        "ImageId": {
          "Ref": "UbuntuImageID"
        },
        "InstanceType": {
          "Ref": "BastionInstanceType"
        },
        "UserData": {
          "Ref": "BastionUserData"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "c1dcc697-c876-4d7d-b222-18013870cef9"
        }
      }
    },
    "BastionSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "BastionSecurityGroup",
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "SecurityGroupEgress": [
          {
            "IpProtocol": "TCP",
            "FromPort": 0,
            "ToPort": 65535,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "UDP",
            "FromPort": 0,
            "ToPort": 65535,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "ICMP",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIp": "0.0.0.0/0"
          }
        ],
        "SecurityGroupIngress": [
          {
            "IpProtocol": "ICMP",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "TCP",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIp": "0.0.0.0/0"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "4719e386-5f75-42ec-9fb2-91f8386f9f87"
        }
      }
    },
    "BastionASG": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "LaunchConfigurationName": {
          "Ref": "BastionLC"
        },
        "MinSize": 1,
        "MaxSize": 1,
        "DesiredCapacity": 1,
        "AvailabilityZones": [
          {
            "Ref": "AvailabilityZone"
          }
        ],
        "Tags": [
          {
            "Key": "KubernetesCluster",
            "Value": {
              "Ref": "ClusterName"
            },
            "PropagateAtLaunch": true
          },
          {
            "Key": "group",
            "Value": "bastion",
            "PropagateAtLaunch": true
          }
        ],
        "LoadBalancerNames": [
          {
            "Ref": "ControllerLoadBalancer"
          }
        ],
        "VPCZoneIdentifier": [
          {
            "Ref": "PublicSubnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "8735ffc7-d4fb-4cdd-befa-8af9fd19f031"
        }
      }
    },
    "BastionIAMInstanceProfile": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [
          {
            "Ref": "BastionIAMRole"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "13349f45-7e38-4fcc-a295-fe5b69a132ca"
        }
      }
    },
    "BastionIAMRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "Path": "/",
        "Policies": [
          {
            "PolicyName": "ec2-describe-instances",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": "ec2:DescribeInstances",
                  "Resource": "*"
                }
              ]
            }
          },
          {
            "PolicyName": "s3-read-cluster-config",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Action": [
                    "s3:ListBucket"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:s3:::",
                        {
                          "Ref": "S3ConfigBucket"
                        }
                      ]
                    ]
                  }
                },
                {
                  "Action": [
                    "s3:GetObject"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:s3:::",
                        {
                          "Ref": "S3ConfigBucket"
                        },
                        "/authorized_keys.d/*"
                      ]
                    ]
                  }
                },
                {
                  "Action": [
                    "s3:GetObject"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:s3:::",
                        {
                          "Ref": "S3ConfigBucket"
                        },
                        "/klondike-cluster-",
                        {
                          "Ref": "ClusterName"
                        },
                        ".tar.gz"
                      ]
                    ]
                  }
                }
              ]
            }
          }
        ],
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "ec2.amazonaws.com"
                ]
              },
              "Action": [
                "sts:AssumeRole"
              ]
            }
          ]
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "d3385b05-b7cc-42cb-a04d-4f49389dfc3d"
        }
      }
    },
    "PublicSubnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "ClusterVPC"
        },
        "CidrBlock": "10.0.255.192/26",
        "MapPublicIpOnLaunch": true,
        "AvailabilityZone": {
          "Ref": "AvailabilityZone"
        },
        "Tags": [
          {
            "Key": "KubernetesCluster",
            "Value": {
              "Ref": "ClusterName"
            }
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "314120e5-87bf-4791-80ae-cd443fad4186"
        }
      }
    }
  },
  "Parameters": {
    "CoreOSImageID": {
      "Type": "AWS::EC2::Image::Id",
      "Description": "Launch Controller and Worker EC2 Instances using this CoreOS AMI"
    },
    "UbuntuImageID": {
      "Type": "AWS::EC2::Image::Id",
      "Description": "Launch Bastion EC2 Instances using this Ubuntu AMI"
    },
    "ControllerInstanceType": {
      "Type": "String",
      "Description": "Launch EC2 Instances in the Controller AutoScaling Group using this Instance type",
      "Default": "m3.large"
    },
    "WorkerInstanceType": {
      "Type": "String",
      "Description": "Launch EC2 Instances in the Worker AutoScaling Group using this Instance type",
      "Default": "m3.large"
    },
    "BastionInstanceType": {
      "Type": "String",
      "Description": "Launch EC2 Instances in the Bastion AutoScaling Group using this Instance type",
      "Default": "m3.medium"
    },
    "AvailabilityZone": {
      "Type": "AWS::EC2::AvailabilityZone::Name",
      "Description": "Deploy all resources into this AvailabilityZone"
    },
    "ClusterName": {
      "Type": "String",
      "Description": "Name of cluster; resources are tagged with this value"
    },
    "ControllerUserData": {
      "Type": "String",
      "Description": "Launch Controller EC2 Instances with this UserData"
    },
    "WorkerUserData": {
      "Type": "String",
      "Description": "Launch Worker EC2 Instances with this UserData"
    },
    "BastionUserData": {
      "Type": "String",
      "Description": "Launch Bastion EC2 Instances with this UserData"
    },
    "ControllerInstanceCount": {
      "Type": "Number",
      "Description": "Number of EC2 Instances to provision as Controllers."
    },
    "WorkerInstanceCount": {
      "Type": "Number",
      "Description": "Number of EC2 Instances to provision as Workers"
    },
    "HostedZone": {
      "Type": "String",
      "Description": "DNS zone hosted in Route 53 that will be used to provide DNS resolution for the Kubernetes API to external clients"
    },
    "ExternalFQDN": {
      "Type": "String",
      "Description": "DNS name in the indicated HostedZone to make routable to the Kubernetes API via the Controller ELB"
    },
    "S3ConfigBucket": {
      "Type": "String",
      "Description": "S3 bucket that hosts the config tarball for this cluster. An object by the name of <ClusterName>.tar.gz must be present in this bucket."
    }
  }
}
